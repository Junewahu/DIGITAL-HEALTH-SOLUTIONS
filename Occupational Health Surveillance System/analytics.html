<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Analytics | Occupational Health</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-user-md"></i>
                <h1>OCCUPATIONAL HEALTH AND SAFETY<span>Minimizing risks, maximizing workplace well-being</span></h1>
            </div>
            
            <nav class="main-nav">
                <ul>
                    <li>
                        <a href="index.html">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="incidents.html">
                            <i class="fas fa-file-medical"></i>
                            <span>Incident Reports</span>
                        </a>
                    </li>
                    <li>
                        <a href="preventive.html">
                            <i class="fas fa-procedures"></i>
                            <span>Preventive Actions</span>
                        </a>
                    </li>
                    <li>
                        <a href="employee.html">
                            <i class="fas fa-heartbeat"></i>
                            <span>Employee Health</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="analytics.html">
                            <i class="fas fa-chart-bar"></i>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li>
                        <a href="compliance.html">
                            <i class="fas fa-clipboard-check"></i>
                            <span>Compliance</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="user-profile">
                <img src="assets/images/medical-avatar.jpg" alt="Medical Professional">
                <div class="user-info">
                    <strong>Dr. June Wahu</strong>
                    <small>Occupational Health Specialist</small>
                </div>
            </div>
        </aside>

        <main class="main-content">
            <header class="content-header">
                <div>
                    <h2>Health Analytics</h2>
                    <p class="subtitle">Data-driven insights for occupational health</p>
                </div>
                <div class="header-actions">
                    <div class="date-picker">
                        <i class="fas fa-calendar-alt"></i>
                        <input type="text" id="analytics-date-range" placeholder="Select date range">
                    </div>
                    <button class="btn btn-primary">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </header>

            <div class="widgets-grid">
                <div class="widget card full-width">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-line"></i> Health Incident Trends</h3>
                        <div class="chart-filters">
                            <select id="trend-metric">
                                <option value="all">All Incidents</option>
                                <option value="musculoskeletal">Musculoskeletal</option>
                                <option value="respiratory">Respiratory</option>
                                <option value="chemical">Chemical Exposure</option>
                                <option value="hearing">Hearing Loss</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <canvas id="health-trend-chart"></canvas>
                    </div>
                </div>

                <div class="widget card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-pie"></i> Incident Types</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="incident-types-chart"></canvas>
                    </div>
                </div>

                <div class="widget card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Department Comparison</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="department-comparison-chart"></canvas>
                    </div>
                </div>

                <div class="widget card full-width">
                    <div class="card-header">
                        <h3><i class="fas fa-table"></i> Health Metrics</h3>
                    </div>
                    <div class="card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Current</th>
                                    <th>Previous</th>
                                    <th>Change</th>
                                    <th>Target</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Lost Time Injuries</td>
                                    <td>3</td>
                                    <td>5</td>
                                    <td class="positive">↓40%</td>
                                    <td>≤4</td>
                                    <td><span class="status success">On Target</span></td>
                                </tr>
                                <tr>
                                    <td>Medical Clearance Rate</td>
                                    <td>92%</td>
                                    <td>88%</td>
                                    <td class="positive">↑4%</td>
                                    <td>≥90%</td>
                                    <td><span class="status success">On Target</span></td>
                                </tr>
                                <tr>
                                    <td>Vaccination Rate</td>
                                    <td>87%</td>
                                    <td>85%</td>
                                    <td class="positive">↑2%</td>
                                    <td>≥95%</td>
                                    <td><span class="status warning">Needs Improvement</span></td>
                                </tr>
                                <tr>
                                    <td>Hearing Conservation</td>
                                    <td>78%</td>
                                    <td>72%</td>
                                    <td class="positive">↑6%</td>
                                    <td>≥85%</td>
                                    <td><span class="status warning">Needs Improvement</span></td>
                                </tr>
                                <tr>
                                    <td>Respiratory Protection</td>
                                    <td>95%</td>
                                    <td>91%</td>
                                    <td class="positive">↑4%</td>
                                    <td>≥95%</td>
                                    <td><span class="status success">On Target</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize date range picker
            flatpickr("#analytics-date-range", {
                mode: "range",
                dateFormat: "Y-m-d",
                defaultDate: [new Date().setDate(new Date().getDate() - 30), new Date()],
                onChange: function(selectedDates, dateStr) {
                    updateCharts(selectedDates);
                }
            });

            // Initialize all charts
            initCharts();

            // Chart filter change handler
            document.getElementById('trend-metric').addEventListener('change', function() {
                updateTrendChart(this.value);
            });

            function initCharts() {
                // Health Incident Trends Chart
                const trendCtx = document.getElementById('health-trend-chart').getContext('2d');
                window.healthTrendChart = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [
                            {
                                label: 'Musculoskeletal',
                                data: [12, 9, 15, 11, 14, 10],
                                borderColor: '#3a7bd5',
                                backgroundColor: 'rgba(58, 123, 213, 0.1)',
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Respiratory',
                                data: [5, 4, 7, 3, 6, 2],
                                borderColor: '#00d2ff',
                                backgroundColor: 'rgba(0, 210, 255, 0.1)',
                                tension: 0.3,
                                fill: true
                            },
                            {
                                label: 'Chemical Exposure',
                                data: [3, 2, 5, 1, 4, 2],
                                borderColor: '#f44336',
                                backgroundColor: 'rgba(244, 67, 54, 0.1)',
                                tension: 0.3,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Health Incident Trends by Month',
                                font: {
                                    size: 14
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Incidents'
                                }
                            }
                        }
                    }
                });

                // Incident Types Chart
                const typesCtx = document.getElementById('incident-types-chart').getContext('2d');
                window.incidentTypesChart = new Chart(typesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Musculoskeletal', 'Respiratory', 'Chemical Exposure', 'Hearing Loss', 'Other'],
                        datasets: [{
                            data: [35, 20, 15, 10, 20],
                            backgroundColor: [
                                'rgba(58, 123, 213, 0.7)',
                                'rgba(0, 210, 255, 0.7)',
                                'rgba(244, 67, 54, 0.7)',
                                'rgba(247, 151, 30, 0.7)',
                                'rgba(108, 117, 125, 0.7)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Incident Type Distribution',
                                font: {
                                    size: 14
                                }
                            },
                            legend: {
                                position: 'bottom'
                            }
                        },
                        cutout: '65%'
                    }
                });

                // Department Comparison Chart
                const deptCtx = document.getElementById('department-comparison-chart').getContext('2d');
                window.departmentChart = new Chart(deptCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Manufacturing', 'Warehouse', 'Laboratory', 'Office', 'Maintenance'],
                        datasets: [
                            {
                                label: 'Injury Rate (per 100)',
                                data: [12, 8, 5, 2, 6],
                                backgroundColor: 'rgba(58, 123, 213, 0.7)'
                            },
                            {
                                label: 'Illness Rate (per 100)',
                                data: [4, 3, 7, 1, 2],
                                backgroundColor: 'rgba(0, 210, 255, 0.7)'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Department Health Metrics',
                                font: {
                                    size: 14
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Rate per 100 Employees'
                                }
                            }
                        }
                    }
                });
            }

            function updateTrendChart(metric) {
                // In a real app, you would fetch new data based on the selected metric
                const trendChart = window.healthTrendChart;
                
                // Sample data update based on selection
                if (metric === 'musculoskeletal') {
                    trendChart.data.datasets[0].data = [12, 9, 15, 11, 14, 10];
                    trendChart.data.datasets[1].data = [0, 0, 0, 0, 0, 0];
                    trendChart.data.datasets[2].data = [0, 0, 0, 0, 0, 0];
                    trendChart.options.plugins.title.text = 'Musculoskeletal Incident Trends';
                } else if (metric === 'respiratory') {
                    trendChart.data.datasets[0].data = [0, 0, 0, 0, 0, 0];
                    trendChart.data.datasets[1].data = [5, 4, 7, 3, 6, 2];
                    trendChart.data.datasets[2].data = [0, 0, 0, 0, 0, 0];
                    trendChart.options.plugins.title.text = 'Respiratory Incident Trends';
                } else if (metric === 'chemical') {
                    trendChart.data.datasets[0].data = [0, 0, 0, 0, 0, 0];
                    trendChart.data.datasets[1].data = [0, 0, 0, 0, 0, 0];
                    trendChart.data.datasets[2].data = [3, 2, 5, 1, 4, 2];
                    trendChart.options.plugins.title.text = 'Chemical Exposure Trends';
                } else {
                    trendChart.data.datasets[0].data = [12, 9, 15, 11, 14, 10];
                    trendChart.data.datasets[1].data = [5, 4, 7, 3, 6, 2];
                    trendChart.data.datasets[2].data = [3, 2, 5, 1, 4, 2];
                    trendChart.options.plugins.title.text = 'All Health Incident Trends';
                }
                
                trendChart.update();
            }

            function updateCharts(dateRange) {
                // In a real app, you would fetch new data based on the date range
                console.log("Updating charts for date range:", dateRange);
                // For now, we'll just simulate an update
                if (dateRange && dateRange.length === 2) {
                    const daysDiff = Math.floor((dateRange[1] - dateRange[0]) / (1000 * 60 * 60 * 24));
                    if (daysDiff < 60) {
                        // Show monthly data
                        window.healthTrendChart.data.labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    } else {
                        // Show quarterly data
                        window.healthTrendChart.data.labels = ['Q1', 'Q2', 'Q3', 'Q4'];
                    }
                    window.healthTrendChart.update();
                }
            }
        });
    </script>
</body>
</html>